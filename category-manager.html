<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Category Manager - Financial Reporting Tool</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { 
      font-size: 14px; 
      background-color: #f8f9fa;
    }
    
    .hero-section {
      background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);
      color: white;
      border-radius: 0.5rem;
      box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.15);
    }
    
    .category-card {
      background-color: white;
      border-radius: 0.5rem;
      box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
      border: none;
      margin-bottom: 1rem;
    }
    
    .keyword-tag {
      background-color: #e9ecef;
      border: 1px solid #dee2e6;
      border-radius: 0.375rem;
      padding: 0.25rem 0.5rem;
      margin: 0.125rem;
      display: inline-block;
      font-size: 0.875rem;
    }
    
    .keyword-tag .remove-btn {
      margin-left: 0.5rem;
      color: #dc3545;
      cursor: pointer;
      font-weight: bold;
    }
    
    .keyword-tag .remove-btn:hover {
      color: #b02a37;
    }
    
    .add-keyword-input {
      min-width: 200px;
    }
    
    .business-category {
      border-left: 4px solid #28a745;
    }
    
    .save-status {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1050;
    }
    
    .category-search {
      position: sticky;
      top: 0;
      background: white;
      z-index: 100;
      border-bottom: 1px solid #dee2e6;
      padding: 1rem 0;
    }
  </style>
</head>
<body>
  <!-- Save Status Alert -->
  <div id="saveStatus" class="save-status"></div>
  
  <div class="container py-4">
    <!-- Header -->
    <div class="hero-section p-4 mb-4">
      <div class="row align-items-center">
        <div class="col-lg-8">
          <h1 class="mb-3">Category Manager</h1>
          <p class="lead mb-0">Customize keywords for automatic transaction categorization. Add or remove keywords to improve accuracy for your specific banking patterns.</p>
        </div>
        <div class="col-lg-4 text-end">
          <a href="index.html" class="btn btn-outline-light me-2">‚Üê Back to Home</a>
          <a href="financial-reporter.html" class="btn btn-light">Launch Reporter</a>
        </div>
      </div>
    </div>

    <!-- Search and Controls -->
    <div class="category-search bg-white rounded mb-4">
      <div class="row align-items-center">
        <div class="col-md-6">
          <div class="input-group">
            <span class="input-group-text">üîç</span>
            <input type="text" class="form-control" id="categorySearch" placeholder="Search categories...">
          </div>
        </div>
        <div class="col-md-6 text-end">
          <button class="btn btn-success me-2" onclick="saveCategories()">üíæ Save Changes</button>
          <button class="btn btn-outline-secondary me-2" onclick="resetToDefaults()">üîÑ Reset to Defaults</button>
          <button class="btn btn-outline-info" onclick="exportCategories()">üì§ Export</button>
          <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importCategories()">
          <button class="btn btn-outline-primary" onclick="document.getElementById('importFile').click()">üì• Import</button>
        </div>
      </div>
    </div>

    <!-- Statistics -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card text-center">
          <div class="card-body">
            <h5 class="card-title text-primary" id="totalCategories">0</h5>
            <p class="card-text">Categories</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center">
          <div class="card-body">
            <h5 class="card-title text-success" id="totalKeywords">0</h5>
            <p class="card-text">Keywords</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center">
          <div class="card-body">
            <h5 class="card-title text-warning" id="businessCategories">0</h5>
            <p class="card-text">Business Categories</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center">
          <div class="card-body">
            <h5 class="card-title text-info" id="avgKeywordsPerCategory">0</h5>
            <p class="card-text">Avg Keywords/Category</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Add New Category -->
    <div class="card category-card mb-4">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">‚ûï Add New Category</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-4">
            <input type="text" class="form-control" id="newCategoryName" placeholder="Category name">
          </div>
          <div class="col-md-6">
            <input type="text" class="form-control" id="newCategoryKeywords" placeholder="Keywords (comma separated)">
          </div>
          <div class="col-md-2">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="newCategoryBusiness">
              <label class="form-check-label" for="newCategoryBusiness">
                Business
              </label>
            </div>
            <button class="btn btn-primary btn-sm mt-1" onclick="addNewCategory()">Add</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Categories List -->
    <div id="categoriesList">
      <!-- Categories will be loaded here by JavaScript -->
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // Default categories and keywords (copied from the main app)
    let CATEGORIES = [
        'Transfers',
        '3KM',
        'Web Hosting',
        'Auto',
        'Bank Fees',
        'Cash',
        'Checks',
        'Child Care and Camps',
        'Deposits',
        'Donations',
        'Education',
        'Entertainment',
        'Fines and Tickets',
        'Girl Scouts',
        'Gifts',
        'Groceries',
        'Hardware',
        'Health and Beauty',
        'Health Supplements',
        'Household',
        'Insurance',
        'Interest Paid',
        'IRS',
        'Medical and Dental Expenses',
        'Mortgage',
        'Office Technology',
        'Office Supplies, Memberships & Subscriptions',
        'Parking',
        'Pets',
        'Postage',
        'Restaurants',
        'Solar Lease',
        'Storage',
        'Subscriptions',
        'Tax Return Preparation',
        'Travel',
        'Unclassified',
        'Utilities',
        'Wine, Beer, Spirits'
    ];

    let BUSINESS_CATEGORIES = [
        'Office Technology',
        'Office Supplies, Memberships & Subscriptions',
        'Web Hosting',
        '3KM'
    ];

    let CATEGORY_KEYWORDS = {
        '3KM': ['3km'],
        'Web Hosting': ['godaddy', 'aws', 'amazon web services', 'google cloud', 'hosting'],
        'Auto': ['chevron', 'shell', 'mobil gas', 'mobil station', 'gas station', 'auto', 'car wash', 'oil change', 'tire', 'mechanic', 'valero', 'exxon', 'bp ', 'citgo', 'arco', 'fastrak', 'bridge toll'],
        'Bank Fees': ['overdraft', 'annual membership fee', 'atm fee', 'maintenance fee', 'wire fee', 'foreign transaction fee'],
        'Cash': ['cash', 'atm withdrawal'],
        'Checks': ['check'],
        'Child Care and Camps': ['child care', 'daycare', 'camp', 'babysit'],
        'Deposits': ['deposit', 'payroll', 'salary', 'wages', 'income', 'direct deposit', 'mobile deposit', 'patreon', 'stripe transfer', 'tripleseat'],
        'Donations': ['donation', 'charity', 'church', 'goodwill'],
        'Education': ['school', 'university', 'college', 'tuition', 'education', 'srjc'],
        'Entertainment': ['movie', 'theater', 'concert', 'entertainment', 'netflix', 'hulu', 'spotify', 'paramount'],
        'Fines and Tickets': ['fine', 'ticket', 'violation', 'penalty'],
        'Girl Scouts': ['girl scout'],
        'Gifts': ['gift'],
        'Groceries': ['safeway', 'grocery', 'whole foods', 'trader joe', 'costco', 'walmart', 'target', 'oliver', 'wholefds'],
        'Hardware': ['home depot', 'lowes', 'hardware', 'ace hardware', 'mission ace'],
        'Health and Beauty': ['cvs', 'walgreens', 'pharmacy', 'cosmetic', 'salon', 'spa', 'beauty'],
        'Health Supplements': ['vitamin', 'supplement', 'gnc', 'health store', 'ryze', 'jn express'],
        'Household': ['household', 'cleaning', 'laundry', 'detergent'],
        'Insurance': ['insurance', 'protective life'],
        'Interest Paid': ['interest', 'finance charge', 'purchase interest charge', 'interest charged'],
        'IRS': ['irs', 'tax payment', 'internal revenue'],
        'Medical and Dental Expenses': ['doctor', 'hospital', 'medical', 'dental', 'dentist', 'physician', 'acupuncture', 'abundance acupuncture'],
        'Mortgage': ['mortgage', 'us bank home mtg'],
        'Office Technology': ['microsoft', 'adobe', 'zoom', 'google', 'apple.com', 'linkedin'],
        'Office Supplies, Memberships & Subscriptions': ['office', 'supplies', 'membership', 'subscription', 'staples'],
        'Parking': ['parking', 'meter', 'garage'],
        'Pets': ['pet', 'vet', 'veterinary', 'petco', 'pet food'],
        'Postage': ['usps', 'fedex', 'ups', 'postage', 'shipping'],
        'Restaurants': ['restaurant', 'cafe', 'bistro', 'grill', 'pizza', 'burger', 'taco', 'chinese', 'italian', 'sushi', 'starbucks', 'dunkin', 'lepe', 'taqueria', 'ozzies', 'everest indian', 'tatte bakery', 'kelly', 'salt and stone', 'mombos pizza', 'wingstop', 'in-n-out', 'the tides bodega bay', 'mcdonalds', 'pho vietnam', 'ikes place', 'savor vietnamese', 'el roy', 'the caviar company', 'campus market & deli'],
        'Solar Lease': ['solar', 'spruce power'],
        'Storage': ['storage', 'storagepro'],
        'Subscriptions': ['subscription', 'monthly', 'annual'],
        'Tax Return Preparation': ['tax prep', 'h&r block', 'turbotax'],
        'Transfers': ['transfer', 'payment thank you', 'ach electronic credit', 'ach deposit', 'ach withdrawal', 'redwood cu ach', 'redwood cu rcu xfer', 'citibank', 'deposit transfer', 'withdrawal transfer', 'home banking transfer', 'checking plus', 'transfer from checking plus', 'share'],
        'Travel': ['hotel', 'airline', 'flight', 'rental car', 'uber', 'lyft', 'taxi', 'hilton', 'marriott', 'travel', 'logan expr', 'commuter rail', 'mbta'],
        'Utilities': ['electric', 'gas', 'water', 'phone', 'internet', 'cable', 'comcast', 'pgande', 'att'],
        'Wine, Beer, Spirits': ['wine', 'beer', 'spirits', 'liquor', 'alcohol', 'totalwine']
    };

    // Load saved categories from localStorage if available
    function loadCategories() {
        const saved = localStorage.getItem('financialReportCategories');
        if (saved) {
            const data = JSON.parse(saved);
            CATEGORIES = data.categories || CATEGORIES;
            CATEGORY_KEYWORDS = data.keywords || CATEGORY_KEYWORDS;
            BUSINESS_CATEGORIES = data.business || BUSINESS_CATEGORIES;
        }
        renderCategories();
        updateStatistics();
    }

    // Save categories to localStorage
    function saveCategories() {
        const data = {
            categories: CATEGORIES,
            keywords: CATEGORY_KEYWORDS,
            business: BUSINESS_CATEGORIES
        };
        localStorage.setItem('financialReportCategories', JSON.stringify(data));
        showSaveStatus('Categories saved successfully!', 'success');
        updateStatistics();
    }

    // Show save status message
    function showSaveStatus(message, type) {
        const statusEl = document.getElementById('saveStatus');
        statusEl.innerHTML = `<div class="alert alert-${type} alert-dismissible fade show">${message}<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>`;
        setTimeout(() => {
            statusEl.innerHTML = '';
        }, 3000);
    }

    // Render categories
    function renderCategories() {
        const container = document.getElementById('categoriesList');
        const searchTerm = document.getElementById('categorySearch').value.toLowerCase();
        
        container.innerHTML = '';
        
        CATEGORIES
            .filter(category => searchTerm === '' || 
                category.toLowerCase().includes(searchTerm) || 
                (CATEGORY_KEYWORDS[category] || []).some(keyword => keyword.toLowerCase().includes(searchTerm))
            )
            .forEach(category => {
                const keywords = CATEGORY_KEYWORDS[category] || [];
                const isBusiness = BUSINESS_CATEGORIES.includes(category);
                
                const card = document.createElement('div');
                card.className = `card category-card ${isBusiness ? 'business-category' : ''}`;
                
                card.innerHTML = `
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            ${category} 
                            ${isBusiness ? '<span class="badge bg-success ms-2">Business</span>' : ''}
                            <small class="text-muted">(${keywords.length} keywords)</small>
                        </h6>
                        <div>
                            <button class="btn btn-outline-primary btn-sm me-2" onclick="toggleBusiness('${category}')">
                                ${isBusiness ? 'Remove Business' : 'Make Business'}
                            </button>
                            <button class="btn btn-outline-danger btn-sm" onclick="deleteCategory('${category}')">Delete</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="mb-2">
                            ${keywords.map(keyword => `
                                <span class="keyword-tag">
                                    ${keyword}
                                    <span class="remove-btn" onclick="removeKeyword('${category}', '${keyword}')">&times;</span>
                                </span>
                            `).join('')}
                        </div>
                        <div class="input-group input-group-sm">
                            <input type="text" class="form-control add-keyword-input" placeholder="Add new keyword" 
                                   id="keyword-${category.replace(/\s+/g, '-')}" onkeypress="handleKeywordEnter(event, '${category}')">
                            <button class="btn btn-outline-primary" onclick="addKeyword('${category}')">Add</button>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
    }

    // Update statistics
    function updateStatistics() {
        const totalCats = CATEGORIES.length;
        const totalKeys = Object.values(CATEGORY_KEYWORDS).reduce((sum, keywords) => sum + keywords.length, 0);
        const businessCats = BUSINESS_CATEGORIES.length;
        const avgKeys = totalCats > 0 ? Math.round(totalKeys / totalCats * 10) / 10 : 0;
        
        document.getElementById('totalCategories').textContent = totalCats;
        document.getElementById('totalKeywords').textContent = totalKeys;
        document.getElementById('businessCategories').textContent = businessCats;
        document.getElementById('avgKeywordsPerCategory').textContent = avgKeys;
    }

    // Add new keyword to category
    function addKeyword(category) {
        const inputId = `keyword-${category.replace(/\s+/g, '-')}`;
        const input = document.getElementById(inputId);
        const keyword = input.value.trim().toLowerCase();
        
        if (keyword && !CATEGORY_KEYWORDS[category].includes(keyword)) {
            CATEGORY_KEYWORDS[category].push(keyword);
            input.value = '';
            renderCategories();
            showSaveStatus(`Added "${keyword}" to ${category}`, 'info');
        }
    }

    // Handle Enter key in keyword input
    function handleKeywordEnter(event, category) {
        if (event.key === 'Enter') {
            addKeyword(category);
        }
    }

    // Remove keyword from category
    function removeKeyword(category, keyword) {
        CATEGORY_KEYWORDS[category] = CATEGORY_KEYWORDS[category].filter(k => k !== keyword);
        renderCategories();
        showSaveStatus(`Removed "${keyword}" from ${category}`, 'warning');
    }

    // Toggle business category
    function toggleBusiness(category) {
        if (BUSINESS_CATEGORIES.includes(category)) {
            BUSINESS_CATEGORIES = BUSINESS_CATEGORIES.filter(c => c !== category);
        } else {
            BUSINESS_CATEGORIES.push(category);
        }
        renderCategories();
        updateStatistics();
        showSaveStatus(`Updated business status for ${category}`, 'info');
    }

    // Delete category
    function deleteCategory(category) {
        if (confirm(`Are you sure you want to delete the "${category}" category?`)) {
            CATEGORIES = CATEGORIES.filter(c => c !== category);
            delete CATEGORY_KEYWORDS[category];
            BUSINESS_CATEGORIES = BUSINESS_CATEGORIES.filter(c => c !== category);
            renderCategories();
            updateStatistics();
            showSaveStatus(`Deleted category "${category}"`, 'warning');
        }
    }

    // Add new category
    function addNewCategory() {
        const name = document.getElementById('newCategoryName').value.trim();
        const keywords = document.getElementById('newCategoryKeywords').value.trim();
        const isBusiness = document.getElementById('newCategoryBusiness').checked;
        
        if (!name) {
            alert('Please enter a category name');
            return;
        }
        
        if (CATEGORIES.includes(name)) {
            alert('Category already exists');
            return;
        }
        
        CATEGORIES.push(name);
        CATEGORY_KEYWORDS[name] = keywords ? keywords.split(',').map(k => k.trim().toLowerCase()) : [];
        
        if (isBusiness) {
            BUSINESS_CATEGORIES.push(name);
        }
        
        document.getElementById('newCategoryName').value = '';
        document.getElementById('newCategoryKeywords').value = '';
        document.getElementById('newCategoryBusiness').checked = false;
        
        renderCategories();
        updateStatistics();
        showSaveStatus(`Added new category "${name}"`, 'success');
    }

    // Reset to defaults
    function resetToDefaults() {
        if (confirm('Are you sure you want to reset all categories to defaults? This will lose all your customizations.')) {
            localStorage.removeItem('financialReportCategories');
            location.reload();
        }
    }

    // Export categories
    function exportCategories() {
        const data = {
            categories: CATEGORIES,
            keywords: CATEGORY_KEYWORDS,
            business: BUSINESS_CATEGORIES,
            exported: new Date().toISOString()
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'financial-categories-export.json';
        a.click();
        URL.revokeObjectURL(url);
        
        showSaveStatus('Categories exported successfully!', 'success');
    }

    // Import categories
    function importCategories() {
        const file = document.getElementById('importFile').files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                if (data.categories && data.keywords && data.business) {
                    CATEGORIES = data.categories;
                    CATEGORY_KEYWORDS = data.keywords;
                    BUSINESS_CATEGORIES = data.business;
                    
                    renderCategories();
                    updateStatistics();
                    showSaveStatus('Categories imported successfully!', 'success');
                } else {
                    alert('Invalid file format');
                }
            } catch (error) {
                alert('Error reading file: ' + error.message);
            }
        };
        reader.readAsText(file);
    }

    // Event listeners
    document.getElementById('categorySearch').addEventListener('input', renderCategories);

    // Initialize
    loadCategories();
  </script>
</body>
</html>